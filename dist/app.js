function loadMedia(){preloader=new createjs.LoadQueue,preloader.on("progress",handleProgress),preloader.on("complete",handleComplete),load()}function load(){for(;images.length>0;){var e=images.shift();preloader.loadFile(e)}}function handleProgress(){}function handleComplete(){background=new Image,background.src=aImg+"space.png",background.onload=function(){ship.image=new Image,ship.image.src=aImg+"ship.png",miniShip.image=new Image,miniShip.image.src=aImg+"ship_min.png",enemyImg=new Image,enemyImg.src=aImg+"enemy.png",shootImg=new Image,shootImg.src=aImg+"shoot.png",enemyShootImg=new Image,enemyShootImg.src=aImg+"enemy_shoot.png",loadAudio(function(){playSound("soundBg")});window.setInterval(frameLoop,1e3/55);ship.image.onload=function(){miniShip.image.onload=function(){}}}}function loadAudio(e){var t=0;for(var n in music){var a=music[n];a.element=document.createElement("audio"),document.body.appendChild(a.element),a.element.setAttribute("src",a.file),a.element.addEventListener("canplaythrough",function(){t++,t==music.length&&e()},!1)}}function playSound(e,t){var n=music.filter(function(t){return t.name===e})[0];if(t){var a=n.element.cloneNode();a.play()}else n.element.play()}function stopSound(e){var t=music.filter(function(t){return t.name===e})[0];t.element.pause()}function drawBackground(){ctx.drawImage(background,0,0)}function drawShip(){ctx.save(),ctx.globalAlpha=keyBoard[37]||keyBoard[39]?.8:1,ctx.drawImage(ship.image,ship.x,ship.y,ship.width,ship.height),ctx.restore()}function drawLives(){for(var e=1;e<=ship.lives;e++)ctx.save(),ctx.drawImage(miniShip.image,miniShip.x-50*e,miniShip.y,miniShip.width,miniShip.height),ctx.restore()}function drawShoot(){for(var e in shoots){var t=shoots[e];ctx.drawImage(shootImg,t.x,t.y,t.width,t.height)}}function fire(){playSound("soundShot",!0),shoots.push({x:ship.x+10,y:ship.y-10,width:30,height:34,status:"fired"})}function moveShoots(){for(var e in shoots){var t=shoots[e];t.y-=2}shoots=shoots.filter(function(e){return e.y>0&&"fired"==e.status})}function updateEnemys(){if("initializing"==game.status){for(var e=0;e<game.enemys;e++)enemys.push({x:10+50*e,y:10,height:26,width:40,status:"alive",count:0});game.status="playing"}for(var e in enemys){var t=enemys[e];t&&("alive"==t.status&&(t.count++,t.x+=5*Math.sin(t.count*Math.PI/90),1==random(0,10*enemys.length)&&(playSound("soundEnemyShot",!0),enemyShoots.push({x:t.x,y:t.y+t.height,width:10,height:30,counter:0}))),"hit"==t.status&&(t.count++,t.count>=10&&(t.status="dead",t.count=0)))}enemys=enemys.filter(function(e){return!("dead"==e.status)})}function drawEnemys(){for(var e in enemys){var t=enemys[e];ctx.drawImage(enemyImg,t.x,t.y,t.width,t.height)}}function drawEnemyShoots(){for(var e in enemyShoots){var t=enemyShoots[e];ctx.drawImage(enemyShootImg,t.x,t.y,t.width,t.height)}}function moveEnemyShoots(){if("playing"==game.status){for(var e in enemyShoots){var t=enemyShoots[e];t.y+=3}enemyShoots=enemyShoots.filter(function(e){return e.y<canvas.height})}}function hit(e,t){return!(e.y+e.height<t.y||e.y>t.y+t.height||e.x+e.width<t.x||e.x>t.x+t.width)}function collitions(){for(var e in shoots){var t=shoots[e];for(var n in enemys){var a=enemys[n];hit(t,a)&&(playSound("soundDeadEnemy",!0),a.status="hit",a.counter=0,t.status="hitted")}}if("hit"!=ship.status&&"dead"!=ship.status)for(var e in enemyShoots){var t=enemyShoots[e];hit(t,ship)&&(playSound("soundDead",!0),ship.status="hit",ship.lives--)}}function moveShip(){if(keyBoard[37]&&(ship.x-=ship.speed,ship.x<0&&(ship.x=0)),keyBoard[39]){ship.x+=ship.speed;var e=canvas.width-ship.width;ship.x>e&&(ship.x=e)}keyBoard[32]?keyBoard.fire||(keyBoard.fire=!0,fire()):keyBoard.fire=!1,"hit"==ship.status&&(ship.counter=0,ship.status="dead",ship.lives>0?game.status="restart":(game.status="over",text.title="Se lo bajaron",text.legend="Dele un balazo para seguir apa",text.counter=0,stopSound("soundBg"),playSound("soundLose")))}function addKeyEvents(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent(t,n)}e(document,"keydown",function(e){keyBoard[e.keyCode]=!0}),e(document,"keyup",function(e){keyBoard[e.keyCode]=!1})}function updateGameStatus(){"playing"==game.status&&0==enemys.length&&(stopSound("soundBg"),playSound("soundWin"),game.status="win",text.title="Gano parce!",text.legend="De un balazo volver a jugar",text.counter=0),"restart"==game.status&&restart(),text.counter>=0&&text.counter++}function restart(){enemyShoots=[],ship.x=100,ship.status="alive",game.status="playing"}function drawText(){if(-1!=text.counter){var e=text.counter/50;if(e>1){for(var t in enemys)delete enemys[t];for(var t in enemyShoots)delete enemyShoots[t]}ctx.save(),ctx.globalAlpha=e,("over"==game.status||"win"==game.status)&&(ctx.fillStyle="white",ctx.font="Bold 30pt Arial",ctx.fillText(text.title,100,200),ctx.font="15pt Arial",ctx.fillText(text.legend,190,250)),ctx.restore()}}function random(e,t){var n=t-e,a=Math.random()*n;return a=Math.floor(a),parseInt(e)+a}function frameLoop(){updateGameStatus(),moveShip(),moveShoots(),collitions(),updateEnemys(),moveEnemyShoots(),drawBackground(),drawShip(),drawLives(),drawShoot(),drawEnemys(),drawText(),drawEnemyShoots()}var canvas=document.getElementById("game"),ctx=canvas.getContext("2d"),ship={x:100,y:canvas.height-120,width:50,height:70,speed:6,image:null,status:"alive",lives:3,counter:0},keyBoard={},game={status:"initializing",enemys:10},text={counter:-1,title:"",legend:""},shoots=[],enemyShoots=[],enemys=[],background,miniShip={x:canvas.width,y:canvas.height-40,width:25,height:35,image:null},aImg="assets/images/",assetsJs="assets/js/",assetsLib="assets/lib/",aMusic="assets/music/",images=[aImg+"bg.jpg",aImg+"space.png",aImg+"ship.png",aImg+"ship_min.png",aImg+"enemy.png",aImg+"shoot.png",aImg+"enemy_shoot.png"],music=[{name:"soundBg",file:aMusic+"bgmusic.mp3"},{name:"soundShot",file:aMusic+"laser_shot.mp3"},{name:"soundEnemyShot",file:aMusic+"laser_enemy.mp3"},{name:"soundDead",file:aMusic+"player_explode.wav"},{name:"soundDeadEnemy",file:aMusic+"enemy_explode.wav"},{name:"soundWin",file:aMusic+"win.mp3"},{name:"soundLose",file:aMusic+"lose.mp3"}],preloader,miniShips=[],enemyImg,shootImg,enemyShootImg,soundBg,soundShot,soundEnemyShot,soundDead,soundDeadEnemy,soundWin,soundLose;loadMedia(),addKeyEvents();